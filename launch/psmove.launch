<launch>
  <arg name="use_oculus" default="false" />
  <arg name="use_psmove" default="true" />
  <arg name="use_kalman_filter" default="true" />
  <arg name="launch_rviz" default="true" />
  <arg name="launch_usbcam" default="false" />
  <arg name="launch_openni" default="true" />
  <arg name="image" default="/camera/rgb/image_rect_color" />
  <arg name="base_frame_id" default="/base_footprint" />
  <arg name="debug" default="false" />


  <group if="$(arg use_psmove)">
    <node name="psmove_tracker"
          pkg="jsk_2014w_rinko" type="psmove_tracker"
          >
      <remap from="image" to="$(arg image)" />
      <remap from="psmove" to="psmove_unfiltered" if="$(arg use_kalman_filter)" />
      <param name="debug" value="$(arg debug)" />
      <param name="color_r" value="255" />
      <param name="color_b" value="255" />
      <param name="color_threshold" value="5" />
      <param name="lpf_threshold" value="3" />
      <param name="canny_threshold" value="200" />
      <param name="center_detection_threshold" value="120" />
      <param name="min_radius" value="3" />
      <param name="max_radius" value="140" />
      <param name="base_frame_id" value="$(arg base_frame_id)" />
    </node>

    <node name="psmove_kalman_filter"
          pkg="jsk_2014w_rinko" type="linear_3d_kalman_filter"
          if="$(arg use_kalman_filter)"
          >
      <remap from="pose" to="psmove_unfiltered" />
      <remap from="pose_filtered" to="psmove" />
    </node>

    <node name="usb_cam"
          pkg="usb_cam" type="usb_cam_node"
          if="$(arg launch_usbcam)" />
    <include file="$(find openni_launch)/launch/openni.launch"
             if="$(arg launch_openni)" />

    <node name="pr2_psmove_controller"
          pkg="jsk_2014w_rinko" type="pr2_psmove_controller.l"
          >
      <param name="multiplier" value="1.5" />
      <param name="z_far" value="1.5" />
      <param name="base_frame_id" value="$(arg base_frame_id)" />
    </node>
  </group>

  <group if="$(arg use_oculus)">
    <node name="rviz" pkg="rviz" type="rviz"
          args="-d $(find jsk_2014w_rinko)/cfg/oculus_rviz_config.rviz"
          if="$(arg launch_rviz)" />
    <node name="pr2_oculus_controller"
          pkg="jsk_2014w_rinko" type="pr2_oculus_controller.l" />
  </group>

</launch>
